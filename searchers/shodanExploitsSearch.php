
<?php
//error_reporting(E_ERROR | E_PARSE);

include ("../inc/config.php");

class moduleShodanExploits
{

	public $vuln=[];


	public function request($uri)
	{
		curl_setopt($this->ch, CURLOPT_URL, $uri);
		curl_setopt($this->ch, CURLOPT_SSL_VERIFYPEER, false);
		curl_setopt($this->ch, CURLOPT_RETURNTRANSFER, true);
		curl_setopt($this->ch, CURLOPT_HEADER, 0);
		$str=curl_exec($this->ch);
		return $str;
	}

	public function startConection(){
		$this->ch = curl_init();
	}

	public function closeConection(){
		curl_close($this->ch);
	}


	public function searchShodanSploits($servicio) {

		$this->startConection();
		$xpluri='https://exploits.shodan.io/api/search?query='.$servicio.'&key='.ldelshodan;
		$extrng=$this->request($xpluri);
		$jsonxpl = json_decode($extrng, JSON_BIGINT_AS_STRING);
		$mas = sizeof($jsonxpl['matches']);

		foreach ($jsonxpl['matches'] as $ploites) {
			$this->vuln[]=$ploites;
		}

		$this->closeConection();

}

	public function getVulns()
	{
		return $this->vuln;
	}

}
